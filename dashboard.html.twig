<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
        <title>Dashboard</title>
        <meta content="Admin Dashboard" name="description" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <!-- App Icons -->
        <link rel="shortcut icon" href="{{asset('assets/images/favicon.ico')}}">

        <!-- morris css -->
        <link rel="stylesheet" href="{{ asset('assets/css/morris.css') }}">

        <!-- App css -->
        <link href="{{ asset('assets/css/bootstrap.min.css') }}" rel="stylesheet" type="text/css" />
        <link href="{{ asset('assets/css/icons.css') }}" rel="stylesheet" type="text/css" />
        <link href="{{ asset('assets/css/style.css') }}" rel="stylesheet" type="text/css" />

    </head>


    <body>

       {% include 'header.html.twig' %}
        <div class="wrapper">
            <div class="container-fluid">

                <!-- Page-Title -->
                <div class="row">
                    <div class="col-sm-12">
                        <div class="page-title-box">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h4 class="page-title m-0">Dashboard</h4>
                                </div>
                            </div>                            
                        </div>
                    </div>
                </div>
                <!-- end page title end breadcrumb -->

                <div class="row">
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-primary mini-stat text-white">
                            <div class="p-3 mini-stat-desc">
                                <div class="clearfix">
                                    <h6 class="mt-0 float-left text-white-50">Number Of Users</h6>
                                </div>                                
                            </div>
                            <div class="p-3">
                                <div class="float-right">
                                    <a href="#" class="text-white-50"><i class="mdi mdi-cube-outline h5"></i></a>
                                </div>
                                <p class="font-14 m-0">{{numberOfActiveUsers | number_format}}</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-primary mini-stat text-white">
                            <div class="p-3 mini-stat-desc">
                                <div class="clearfix">
                                    <h6 class="mt-0 float-left text-white-50">Queue</h6>
                                </div>                                
                            </div>
                            <div class="p-3">
                                <div class="float-right">
                                    <a href="#" class="text-white-50"><i class="mdi mdi-cube-outline h5"></i></a>
                                </div>
                                <p class="font-14 m-0" id="queue_size">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-primary mini-stat text-white">
                            <div class="p-3 mini-stat-desc">
                                <div class="clearfix">
                                    <h6 class="mt-0 float-left text-white-50">Rules</h6>
                                </div>                                
                            </div>
                            <div class="p-3">
                                <div class="float-right">
                                    <a href="#" class="text-white-50"><i class="mdi mdi-cube-outline h5"></i></a>
                                </div>
                                <p class="font-14 m-0">{{ rules | length }}</p>
                            </div>
                        </div>
                    </div>

                </div>  
                <!-- end row -->

                <div class="row">
                    <div class="col-sm-8">
                        <div class="card m-b-30">
                            <div class="card-body">

                                <h4 class="mt-0 header-title">Bar Chart</h4>

                                <div id="morris-bar-example" class="morris-chart" style="height: 300px"></div>

                            </div>
                        </div>
                    </div> <!-- end col -->

                    <div class="col-sm-4">
                        <div class="card">
                            <div class="card-body">

                                <h4 class="mt-0 header-title">Users Repo</h4>

                                <div id="morris-donut-example" class="morris-chart" style="height: 300px"></div>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- end row -->

            </div> <!-- end container-fluid -->
        </div>
        <!-- end wrapper -->


        <!-- Footer -->
        {% include 'footer.html.twig' %}
        <!-- End Footer -->


        <!-- jQuery  -->
        <script src="{{ asset('assets/js/jquery.min.js') }}"></script>
        <script src="{{ asset('assets/js/bootstrap.bundle.min.js') }}"></script>
        <script src="{{ asset('assets/js/modernizr.min.js') }}"></script>

        <script src="{{ asset('assets/js/waves.js') }}"></script>

        <script src="{{ asset('assets/js/jquery.slimscroll.js') }}"></script>

        <!--Morris Chart-->
        <script src="{{ asset('assets/js/morris.min.js') }}"></script>
        <script src="{{ asset('assets/js/raphael.min.js') }}"></script>

        <!-- App js -->
        <script src="{{ asset('assets/js/app.js') }}"></script>

        <script>

            //creating bar chart
            /*var $barData = [
                {y: '2009', a: 100, b: 90},
                {y: '2010', a: 75 , b: 65},
                {y: '2011', a: 50 , b: 40},
                {y: '2012', a: 75 , b: 65},
                {y: '2013', a: 50 , b: 40},
                {y: '2014', a: 75 , b: 65},
                {y: '2015', a: 100, b: 90},
                {y: '2016', a: 90 , b: 75}
            ];*/

            var $barData={{ chartData | raw }}

            Morris.Bar({
                element: 'morris-bar-example',
                data: $barData,
                xkey: 'y',
                ykeys: ['a', 'b'],
                labels: ['Members', 'Views'],
                gridLineColor: '#eef0f2',
                barSizeRatio: 0.4,
                resize: true,
                hideHover: 'auto',
                barColors: ['#5985ee', '#46cd93']
            });

    
            //creating donut chart
            var $donutData = [
                {label: "Active Users", value: {{numberOfActiveUsers}}},
                {label: "Pending for activation", value: {{numberOfPendingUsers}}}
            ];
    
            Morris.Donut({
                element: 'morris-donut-example',
                data: $donutData,
                resize: true,
                colors: ['#4bbbce', '#5985ee', '#46cd93']
            });



            setInterval(function(){
                $.getJSON( "/api/get_queue_size", function( data ) {
                    var num=data.result.size[0];
                    $("#queue_size").html(num.toLocaleString());
                });

            }, 60000);
        </script>

    </body>
</html>